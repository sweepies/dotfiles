#!/usr/bin/env bash
IGNORE_LIST=("google-cloud-sdk")

file="/tmp/updates_available.txt"

function checkUpdates {
    echo "Checking for package updates"

    yay -Qyu > $file
}

function printUpdates {
    updates=$(cat $file)

    for package in "${IGNORE_LIST[@]}"; do
        updates=$(echo -n $updates | sed -e "/^$package/d")
    done
    
    updates=$(echo -n "$updates" | wc -l)

    if [[ $updates == 0 ]]; then
        return
    fi

    if [[ $updates == 1 ]]; then
        echo "1 update is available."
        return
    fi
    echo "$updates updates are available."
}


if [[ -f $file ]]; then
    time=$(date +%s)
    last_modified=$(stat -c %Y $file)
    if [[ $((time - last_modified)) -ge 259200 ]]; then # if not checked in 3 days
        checkUpdates
    fi
    
    printUpdates
else
    checkUpdates
    printUpdates
fi
